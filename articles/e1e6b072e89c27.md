---
title: "【Next.js 16】非推奨となった middleware.ts → proxy.ts への移行"
emoji: "🚦"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["nextjs","middleware","proxy"]
published: true
---

## はじめに

Next.js 16 へアップデートしてデプロイした際、ビルドログに「middleware は非推奨になりました」という警告が表示されるようになりました。
本記事では、Next.js 16 で導入された middleware.ts から proxy.ts への移行について、「今すぐ直す必要があるのか」「どこまで対応すればよいのか」という判断に迷いやすいポイントを主軸に整理します。

## 対象者

* Next.js 16 にアップデートした または アップデート予定のエンジニア
* middleware.ts を使った認証やリダイレクト処理を運用している方
* デプロイ時に今回の警告メッセージを見かけた方

## 結論

まず、結論は以下の通りです。

* 今すぐ壊れるわけではない
* 放置前提でよい変更ではない
* 対応コストは低いため、早めの移行がおすすめ

## 今すぐ直す必要はあるのか

緊急対応は不要です。

middleware.ts は Next.js 16 時点ではまだ動作します。警告は表示されますが、ビルドエラーやランタイムエラーにはなりません。そのため、デプロイが即失敗することはありません。
一方で、この警告は単なる名称変更の案内ではなく、将来的な削除を前提とした非推奨です。公式の移行ガイドや codemod（ファイル名や関数名を自動で変換してくれるツール）が用意されていることからも、一定期間後に削除されると思われます。

## なぜ放置すべきではないのか

理由は大きく三つあります。

* 将来の Next.js アップデートで突然削除されるリスクです。非推奨期間がどれくらい続くかは明示されていないため、ある日アップデートしたらビルドが通らなくなる可能性があります。
* チームや将来の自分が混乱しやすい点です。公式ドキュメントでは proxy.ts が前提になっていくため、middleware.ts が残っていると認知負荷が上がります。
* 対応コストが非常に低い点です。実際の変更はファイル名と関数名が中心で、ロジック自体はそのまま移行できます。時間が経ってから慌てて対応するより、落ち着いて対応できる今のほうが安全です。

## 対応内容

最低限やるべきことは次の三点です。

1. middleware.ts を proxy.ts にリネームする
2. export する関数名を middleware から proxy に変更する
3. middleware.ts を完全に削除する

具体的にどのファイルをどう修正するのかを以下の通り紹介します。

### 修正対象ファイル

Next.js プロジェクトのルート直下に存在する、次のファイルが対象です。

* middleware.ts

### 1. middleware.ts を proxy.ts にリネームする

このファイルを proxy.ts に置き換えます。

### ファイル名の変更

```diff
- middleware.ts
+ proxy.ts
```

:::message
**ポイント**
ファイルの配置場所は変えず、名前のみを変更します。
:::

### 2. export する関数名を middleware から proxy に変更する

middleware.ts で定義されていた関数名を proxy に変更します。

```ts:proxy.ts
import { NextRequest, NextResponse } from "next/server";

export function proxy(req: NextRequest) { // 関数名を middleware → proxy に変更
  const url = req.nextUrl.clone();

  // 例 認証されていない場合はログインへリダイレクト
  if (!req.cookies.get("session")) {
    url.pathname = "/login";
    return NextResponse.redirect(url);
  }

  return NextResponse.next();
}
```
:::message
**ポイント**
関数内部のロジックは変更不要です。middleware 関数名を proxy に変えるだけで問題ありません。
:::

### 3. middleware.ts を完全に削除する

proxy.ts を作成したら、middleware.ts は必ず削除します。両方が存在すると挙動が不安定になります。

対応後は、認証やリダイレクト周りの動作確認を行いましょう。

## おわりに

私自身、今回の変更はコードを大きく書き換える必要はないものの、今まで問題なく動いていたものが急に非推奨と出て不安になりました。ただ、整理してみると対応範囲は小さく、早めに済ませておくことで将来の不安が一つ減りました。
この記事が、今すぐ直すべきかどう直すべきか迷っている方の判断材料になれば幸いです。

---

## 株式会社ONE WEDGE
【Serverlessで世の中をもっと楽しく】
ONE WEDGEはServerlessシステム開発を中核技術としてWeb系システム開発、AWS/GCPを利用した業務システム・サービス開発、PWAを用いたモバイル開発、Alexaスキル開発など、元気と技術力を武器にお客様に真摯に向き合う価値創造企業です。
https://onewedge.co.jp/