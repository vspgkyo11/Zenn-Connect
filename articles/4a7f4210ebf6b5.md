---
title: "[Laravel×Dropzone.js]ドラッグ&ドロップ対応のアップロード機能を構築する"
emoji: "📥"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["laravel"]
published: false
---
#  「ファイルアップロードを便利に！」Laravelでドラッグ&ドロップ対応のアップロード機能を構築

Laravelの機能を最大限に活用し、Dropzone.jsを組み合わせることでドラッグ&ドロップ対応のファイルアップロード機能を実装します。この記事では、これらを実現するための正確なステップを詳細に解説します。

---

## 開発環境

以下の開発環境を使用しました：

- **OS**: Windows 11
- **Web Server**: XAMPP v3.3
- **PHP**: 8.2.12
- **Laravel Framework**: 11.40.0

---

## コンセプト

- Laravelを使ってファイルのアップロード機能を実装する
- Dropzone.jsでドラッグ&ドロップでファイルを選択できるユーザーフレンドリーなUIを構築する
- Tailwind CSSでモダンなデザインを実現

---

## Laravelプロジェクトの構築

1. Laravelプロジェクトを新規作成

    ```bash
    composer create-project laravel/laravel drag-drop-upload
    cd drag-drop-upload
    php artisan serve
    ```

2. データベーステーブルの作成

    ```bash
    php artisan make:migration create_files_table --create=files
    ```

    構造を次のように設定します：

    ```php
    public function up()
    {
        Schema::create('files', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('path');
            $table->timestamps();
        });
    }
    ```

3. テーブルのマイグレーション

    ```bash
    php artisan migrate
    ```

4. ルートの設定

    `routes/web.php`に次を追加します：

    ```php
    use Illuminate\Support\Facades\Route;
    use App\Http\Controllers\FileUploadController;

    Route::get('/', function () {
        return view('welcome');
    });

    Route::get('/upload', function(){
        return view('upload');
    });

    Route::post('/upload', [FileUploadController::class, 'store']);
    ```

5. コントローラの実装

    `FileUploadController.php`に次のコードを追加します：

    ```php
    <?php
    namespace App\Http\Controllers;

    use Illuminate\Http\Request;
    use Illuminate\Support\Facades\Storage;

    class FileUploadController extends Controller
    {
        public function store(Request $request)
        {
            if ($request->hasFile('file')) {
                $file = $request->file('file');
                $filename = time() . '_' . $file->getClientOriginalName();
                $path = $file->storeAs('uploads', $filename, 'public');

                return response()->json([
                    'success' => true,
                    'file_path' => $path,
                    'file_name' => $filename
                ]);
            }

            return response()->json(['success' => false], 400);
        }
    }
    ```

---

## UIの構築

`resources/views/upload.blade.php`に次のデザインを追加しました：

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ファイルアップロード</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Dropzone.js の CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.css">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-lg p-6 bg-white rounded-lg shadow-md">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">ファイルアップロード</h1>
        <form action="/upload" class="dropzone border-2 border-dashed border-blue-500 rounded-lg bg-gray-50 p-6 text-center" id="file-dropzone">
            @csrf
            <p class="text-gray-600">ここにファイルをドラッグ＆ドロップするか、クリックして選択してください</p>
        </form>
    </div>

    <!-- Dropzone.js の JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.js"></script>
    <script>
        Dropzone.options.fileDropzone = {
            maxFilesize: 2, // MB
            acceptedFiles: ".jpeg,.jpg,.png,.gif",
            dictDefaultMessage: "ここにファイルをドラッグ＆ドロップしてください",
            success: function(file, response) {
                console.log(response);
                alert("アップロードが成功しました: " + response.file_name);
            },
            error: function(file, response) {
                alert("アップロードに失敗しました");
            }
        };
    </script>
</body>
</html>
```

---

## 結論

LaravelとDropzone.jsを使用することで、ドラッグ&ドロップ応復のファイルアップロード機能を簡単に実装できます。Tailwind CSSにより、ユーザーに触りやすいデザインにしています。これにより、モダンなUIと高機能なファイル操作を一緒に実現できます。

