---
title: "【Node.js】AWS EC2 (Debian 12) で Node.js 20 から v24/v25 へアップグレードガイド"
emoji: "🚀"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["nodejs","linux","debian","aws"]
published: false
---

![](/images/nodejs20-upgrade/zenn_nodejs20-24-25.png)

## はじめに

クラウド環境での運用において、ランタイムのアップデートは避けて通れません。昨今では、Node.js v24がLTSとなり、セキュリティ水準が一段階引き上げられました。

クラウドインフラ（AWS EC2）において、ランタイムのバージョン管理はセキュリティと安定稼働の要です。
Node.js v24 (LTS) がリリースされ、セキュリティ水準が向上した今、Debian 12 環境における v20 からの移行は急務と言えます。

本記事では、開発環境向けの `nvm` やコンテナ技術（Docker）ではなく、**OS標準のパッケージ管理システム (`apt`)** を採用し、システム全体で整合性の取れた「堅牢なアップグレード」を実現する手順を解説します。

本記事では、AWS EC2上のDebian 12環境において、既存のNode.js 20を安全に、かつ最短ルートで最新の安定版（v24）または最新機能版（v25）へアップグレードする手順を解説します。

## 対象者

* AWS EC2 (Debian 12 / Bookworm) を運用中のエンジニア
* 本番環境における「再現性」と「安定性」を優先し更新対応したい方
* `nvm` によるパス問題や `systemd` との連携トラブルを回避したい方

## 本番環境における戦略：nvm ではなく apt を採用する理由

開発環境ではバージョン切り替えが容易な `nvm` や `asdf` が重宝されますが、本番サーバーにおいては **NodeSource リポジトリ経由の `apt` インストール** が推奨されます。

### 1. systemd / crond との親和性
`nvm` はシェル関数として動作するため、`.bashrc` 等の読み込みに依存します。これに対し、`apt` でインストールされた Node.js は `/usr/bin/node` という固定パスに配置されます。これにより、Systemd のユニットファイルや Cron ジョブ内で環境変数を意識することなく、確実にバイナリを実行できます。

### 2. セキュリティ更新の自動化
OS のパッケージ管理システムに乗せることで、`apt update / upgrade` のサイクルの中で Node.js のセキュリティパッチも適用可能になります。独自の管理ツール（`nvm`）を用いる場合、更新漏れのリスクが高まります。

| 比較項目 | apt (NodeSource) | nvm |
| :--- | :--- | :--- |
| **用途** | **本番サーバー・商用環境** | ローカル開発・検証環境 |
| **実行パス** | `/usr/bin/node` (固定) | `~/.nvm/versions/...` (動的) |
| **権限** | システム全体 (root/System) | ユーザー単位 |
| **保守性** | OS標準の更新サイクルに追従 | 手動管理が必要 |

---

## アップグレード手順

### 1. 現状確認

作業前に現在のバージョンとインストール経路を確認します。

```bash
# 現在のバージョンを確認
node -v
# 期待値: v20.x.x

# npmの場所を確認
which npm
# /usr/bin/node (aptの場合)
```

### 2. 旧リポジトリ設定のクリーンアップ

Debian 12 では `/etc/apt/sources.list.d/` 配下にリポジトリ設定があります。新旧バージョンの競合を防ぐため、既存の設定を削除します。

```bash
# 既存設定の確認
ls /etc/apt/sources.list.d/nodesource.list

# 設定ファイルの削除
sudo rm -f /etc/apt/sources.list.d/nodesource.list
```

### 3. Node.js v24 (LTS) の導入

NodeSource が提供するセットアップスクリプトを使用し、v24 のリポジトリをシステムに追加します。

```bash
# セットアップスクリプトの取得と実行 (v24 LTS)
curl -fsSL https://deb.nodesource.com/setup_24.x | sudo -E bash -

# v25 (Current) を導入したい場合はこちら
# curl -fsSL https://deb.nodesource.com/setup_25.x | sudo -E bash -
```

:::message
**LTS（Long Term Support）と Current　とは**
LTS（v24）は長期間の保守が保証された本番環境推奨版です。一方、Current（v25）は最新機能が含まれますがサポート期間が短いため、用途に合わせて選択してください。
:::

:::message alert
**注意事項**
最新機能を利用したい場合は、URLを `setup_25.x` に変更することで v25 (Current) をインストール可能です。ただし、本番運用にはサポート期間の長い LTS (v24) を推奨します。
:::

### 4. インストールとビルドツールの整備

リポジトリ更新後、パッケージをインストールします。ネイティブモジュールのコンパイルに備え、`build-essential` も同時に確認します。

```bash
sudo apt-get install -y nodejs build-essential
```

### 5. 動作確認

バージョンが正しく更新されたことを確認します。

```bash
node -v
# v24.x.x

npm -v
# v10.x.x (Node.js v24同梱版)
```

最後に、既存プロジェクトの依存関係を再構築して完了です。

```bash
# プロジェクトディレクトリにて
rm -rf node_modules package-lock.json
npm install
```

## おわりに

サーバー構成をコード管理（IaC）する時代であっても、その根底にあるランタイムの管理方針は「シンプルさ」と「堅牢性」が鍵となります。`apt` を選択することは、OS の作法に従い、予期せぬトラブルを最小限に抑えるための賢明な判断です。

この手順が、安全なインフラ運用の助けになれば幸いです。

---

## 株式会社ONE WEDGE
【Serverlessで世の中をもっと楽しく】
ONE WEDGEはServerlessシステム開発を中核技術としてWeb系システム開発、AWS/GCPを利用した業務システム・サービス開発、PWAを用いたモバイル開発、Alexaスキル開発など、元気と技術力を武器にお客様に真摯に向き合う価値創造企業です。
https://onewedge.co.jp/