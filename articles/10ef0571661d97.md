---
title: "【Next.js 14】 App Router と Pages Router の“共存”"
emoji: "🔀"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["nextjs","approuter","pagesrouter"]
published: false
---

## はじめに

Next.js 13 から新しい App Router が登場し、従来の Pages Router と大きく異なる仕組みを持ちます。公式も新規開発では App Router を推奨しています。
そして、Next.js 14 では、従来の Pages Router と新しい App Router を同一プロジェクト内で併用できます。既存の pages ディレクトリを維持しつつ、段階的に app ディレクトリへ移行することで、リリースリスクを抑えながら最新機能を取り込めます。

本記事ではそれぞれの特徴や違いを整理し、共存運用や段階的移行の実例を解説します。

### バージョン要件

* Node.js 18 以上が推奨
* Next.js 14.x 系を利用すること

## 対象者

* Next.js を既に pages ディレクトリで運用している人
* App Router を一気に移行せず、ページ単位で段階的に導入したい人
* React Server Components やレイアウト機能を安全に試したい人

## ゴール

* 共存の基本原則を理解する
* 既存プロジェクトへ app ディレクトリを追加し、安全な導入手順を実行できる
* 代表的な落とし穴を事前に回避できる


## 前提知識

### Pages Router とは

* /pages ディレクトリにファイルを置くことでルーティングされる
* ファイルベースルーティング (例: pages/about.tsx → /about)
* Next.js 初期からの仕組みで利用実績が豊富
* メリット: シンプルで学習コストが低い、情報が豊富
* デメリット: 柔軟なレイアウトやデータフェッチ戦略が限定的、大規模化で煩雑になりやすい

### App Router とは

* /app ディレクトリに基づく新しいルーティングシステム
* React Server Components (RSC) をデフォルトで採用
* レイアウト・テンプレート・サーバーアクションなど最新の仕組みを活用可能
* メリット: 柔軟なレイアウト構造、サーバー側での fetch、ストリーミングやキャッシュ戦略によるパフォーマンス改善
* デメリット: Pages Router からの移行難易度が高く学習コストが大きい

### 使い分けの目安

* Pages Router: 既存プロジェクトの延長で開発したい、小〜中規模、素早く立ち上げたい場合
* App Router: 新規開発、パフォーマンスや将来性を重視、複雑なレイアウトやデータフェッチが必要な場合

## App Router と Pages Router の違い

| 項目        | Pages Router                            | App Router                             |
| --------- | --------------------------------------- | -------------------------------------- |
| ルーティング定義  | `pages/` ディレクトリにファイル配置                  | `app/` ディレクトリにファイル配置                   |
| データ取得     | `getStaticProps` / `getServerSideProps` | サーバーコンポーネント内で直接 `fetch` 可能             |
| レイアウト管理   | `_app.js`, `_document.js`               | `app/layout.tsx` による階層的レイアウト           |
| コンポーネント種別 | すべてクライアントコンポーネント                        | デフォルトがサーバーコンポーネント（`"use client"` で明示可） |
| エラーハンドリング | 各ページごとに try/catch 等で実装                  | `error.tsx` を置くとルート単位でエラーバウンダリ         |
| ストリーミング   | 非対応                                     | 部分レンダリング・ストリーミングが標準                    |
| 安定性       | 長年の実績があり枯れている                           | Next.js 13 以降で追加され、14 で安定性が高まった        |

### メリットとデメリット

* Pages Router のメリット

  * 安定しており既存記事やサンプルが豊富
  * SSR/CSR の仕組みがシンプル
  * 既存プロジェクトやレガシー資産との互換性が高い

* Pages Router のデメリット

  * レイアウト管理が単層的で複雑化しやすい
  * 新しい RSC やストリーミングといった最新機能は非対応

* App Router のメリット

  * React Server Components を前提とした最新構成
  * 階層的なレイアウト管理やエラーハンドリングが容易
  * ストリーミング・部分プリレンダリングなどの新機能に対応

* App Router のデメリット

  * Pages Router と比べて知見が少なく、移行には学習コストが必要
  * 一部 API やサードパーティライブラリとの互換性課題が残る

### 共存の有用性

* 一度に全ページを App Router に移す必要がない
* Pages Router の安定性を活かしつつ、新規ページは App Router で実装できる
* リリースリスクを下げながら最新機能を取り込める
* チーム内で段階的に新機能を学習・検証できる

## ディレクトリ構成の対比

### 📂 Pages Router の例

```
my-next-app/
├─ pages/
│  ├─ index.tsx
│  └─ posts/[slug].tsx
├─ public/
└─ next.config.js
```

### 📁 App Router の例

```
my-next-app/
├─ app/
│  ├─ layout.tsx
│  ├─ page.tsx
│  ├─ posts/
│  │  └─ [slug]/page.tsx
│  ├─ error.tsx
│  └─ loading.tsx
├─ public/
└─ next.config.js
```

| 項目       | Pages Router                       | App Router                  |
| -------- | ---------------------------------- | --------------------------- |
| ルートエントリ  | `pages/` 内のファイル                    | `app/` 内の page.tsx          |
| グローバル設定  | `_app.js`, `_document.js`          | `layout.tsx`                |
| API ルート  | `pages/api/`                       | `app/api/` (Route Handlers) |
| エラー処理    | try/catch 等で実装                     | `error.tsx` を配置             |
| ローディング   | カスタムロジック                           | `loading.tsx` を配置           |
| 静的生成/SSR | getStaticProps, getServerSideProps | サーバーコンポーネント + fetch         |

このように、ディレクトリ構成レベルでも両者は明確に異なり、どちらを選ぶかで設計の指針が変わる。

* 一度に全ページを App Router に移す必要がない
* Pages Router の安定性を活かしつつ、新規ページは App Router で実装できる
* リリースリスクを下げながら最新機能を取り込める
* チーム内で段階的に新機能を学習・検証できる

## 共存の基本原則

* ディレクトリ構成

  * pages と app を同居させられる
  * 同じパスを両方に定義した場合、App Router 側が優先される
* `_app.js` と `_document.js` の役割は app/layout に統合できる
* 併用のねらい

  * 影響範囲の小さい画面から App Router 化し、テスト済みになったら徐々に移行を広げる

## まずはここから 作業の前提

* Node.js と Next.js のバージョン要件を満たす
* 既存の pages と API の動作がグリーンであることを確認する
* VCS で小さなコミットを刻み、差分を明確化する

## 実例 既存の pages プロジェクトに app を部分導入

以下はブログサイトを例に、トップページのみ App Router へ置き換える手順。

### 1 プロジェクト直下に app ディレクトリを追加

```
my-next-app/
├─ pages/
│  ├─ index.tsx
│  └─ posts/[slug].tsx
├─ app/
│  └─ page.tsx
├─ public/
└─ next.config.js
```

* app/page.tsx を追加すると、ルートパスは App Router が担当する
* 既存の pages/index.tsx は残してよいが、同一ルートは app 側が優先される

### 2 app の基本ファイルを用意

* グローバルレイアウト

```
// app/layout.tsx
export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="ja">
      <body>{children}</body>
    </html>
  )
}
```

* トップページ

```
// app/page.tsx
export default function Home() {
  return <main>App Router のトップページ</main>
}
```

### 3. クライアントコンポーネントの指定

* App Router ではデフォルトがサーバーコンポーネント
* ブラウザ API やイベント処理を含む場合は先頭にディレクティブを付与

```
"use client"
```

### 4. `pages/_app.js` と `pages/_document.js` の扱い

* Pages Router 時代の `_app` や `_document` で設定していた内容は、app/layout.tsx に移す必要がある
* 共存期間は `_app` 側が残っていても動作はするが、グローバルスタイルやメタ情報を二重管理しないよう注意


### 4 Link, Image, Metadata の差異に注意

* `next/link` の `legacyBehavior` は非推奨
* `next/image` はデフォルト挙動が pages と異なる
* `next/head` は利用できず、App Router では metadata API を使用する


### 5. ルーティングの切り分け戦略

* まずは影響の小さい静的ページや新規ページから app へ
* 既存の複雑なページは pages に残す
* API ルートは当面 pages/api を継続し、将来必要に応じて app の Route Handler へ移行

### 6. 共存時のビルドと型の注意

* 型や ESLint ルールで app 専用のパターンに未対応な設定があると警告が出る
* tsconfig の paths や baseUrl を見直し、サーバーコンポーネントでの import 先を整理


## 代表的な落とし穴と回避策

### 同一路径の競合

* pages と app に同じパスがあると app が優先される
* 一時的に pages 側を利用したいケースでは、app 側の該当ファイルを一時リネームする運用も可能

### next/link と next/image の差異

* App Router では Link コンポーネントが常に `<a>` をラップする
* Image コンポーネントの挙動も一部変更されている
* Head コンポーネントは非推奨で、Metadata API に移行が推奨される

### pageExtensions の影響

* 拡張子カスタマイズを行っていると app 側の解決に影響することがある
* 共存前に最小構成に寄せるか、設定の適用範囲を確認する

### i18n とミドルウェア

* 国際化設定や middleware の振る舞いはルート解決順序に依存する
* 共存期間はミドルウェアの影響範囲を限定し、想定ルートのみで検証する

### サードパーティ認証や状態管理

* クライアント側のコンテキスト依存が強い画面は移行難易度が高い
* まずはサーバーコンポーネント中心のページから移行し、認証やグローバル状態は最後に回す

### Hooks の違い

* Pages Router の `useRouter` は app ディレクトリでは利用できない
* App Router では `next/navigation` の `useRouter`, `usePathname`, `useSearchParams` を利用する
* Client Component でのみ利用可能である点に注意

### Partial Prerendering (PPR)

* Next.js 14 では experimental フラグを有効にして canary チャネルで利用可能
* Production 環境での安定利用は非推奨
* クライアントサイドナビゲーション時には適用されない制約がある

## ステップバイステップ移行計画の例

1 トップページや会社概要など静的性の高いページを app 化
2 新規開発ページは原則 app で実装
3 ページ配下の一部機能を Route Group で段階的に移行
4 認証が絡むダッシュボードや検索結果ページをテスト付きで移行
5 最後に API ルートと残存 pages を app へ統合

## ディレクトリ設計のヒント

* app では colocation がしやすい
* コンポーネントや fetch ロジックはフォルダ内に近接配置し、private フォルダで境界を分ける
* Route Group を用いて URL 構造を変えずに内部構成を整理できる

## 検証のコツ

* e2e テストでルーティングと描画の差分を検知
* 主要ブラウザとモバイル表示でレイアウト崩れを確認
* パフォーマンス計測でストリーミングやキャッシュの効果を観測

## まとめ

* App Router と Pages Router は同一プロジェクトで共存できる
* ルート競合時は App Router が優先される
* 小さく導入し、落とし穴を回避しながら段階的に移行するのが実践的

## 参考リンク

* [Next.js 公式 App Router への移行ガイド](https://nextjs.org/docs/app/guides/migrating/app-router-migration)
* 
* [Next.js 14 リリースノート](https://nextjs.org/blog/next-14)
* [Partial Prerendering (実験的機能)](https://nextjs.org/docs/14/app/api-reference/next-config-js/partial-prerendering)
* [next/navigation Hooks のドキュメント](https://nextjs.org/docs/app/building-your-application/routing#navigation)


## おわりに

業務や個人開発では、フレームワークの大規模移行に躊躇しがちだと思う。だからこそ、まずは一画面だけ app で作ってみる。テストが通り、関係者の合意が取れたら次の画面へ進める。小さな成功体験の積み重ねは、結果として移行全体のスピードを上げてくれる。読者が安心して一歩目を踏み出せるきっかけになればうれしい。
