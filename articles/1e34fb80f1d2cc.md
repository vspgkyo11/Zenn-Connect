---
title: "【Laravel】はじめてのWebサーバーのアップグレードガイド"
emoji: "🧭"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Webサーバー", "Laravel"]
published: false
---

## はじめに

サーバー上のフレームワークやミドルウェアを更新する作業は、とても緊張感があります。つい更新作業を後回しにしていないでしょうか。

この記事では、具体的なコマンドを叩く前に知っておくべき更新の戦略地図をお渡しします。闇雲に手を動かすのではなく、どの順番で何を確認すれば安全にゴールできるのか。そのロジックを理解すれば、Docker環境であろうとなかろうと、恐れることはありません。

## 対象者

* 個人開発でLaravelアプリをリリースしたが、一度も更新作業をしたことがない方
* PHPのバージョンを上げてくださいと警告が出たが、何から手をつけていいかわからない方
* Dockerを使っているが、コンテナの更新とフレームワークの更新の関係性が曖昧な方

## 依存関係のピラミッド

更新作業では、それぞれの技術要素が互いにどう依存しているかを把握しましょう。
まずはこの階層構造をイメージしてください。

1. アプリケーション（あなたの書いたLaravelコード）
2. フレームワーク（Laravel本体）
3. 言語・ミドルウェア（PHP, MySQL, Nginxなど）
4. OS・インフラ（Linux, Dockerコンテナ）

:::message
**ポイント**
重要なルールがあります。それは「上層は下層に依存する」ということです。Laravelは特定のバージョンのPHPでしか動きません。アプリのコードは特定のバージョンのLaravelでしか動きません。したがって、更新計画は「上から調査し、下から固める」のが鉄則です。
:::

## 更新の絶対手順「サンドイッチ作戦」

安全なアップグレードには正しい順序があります。以下の5ステップで進めます。

## Step 0 現在の状態を確認

まず、OSの種類とバージョンを確認します
パッケージ管理ツールの対応状況に関わります。

```bash
cat /etc/os-release
```
次に、カーネルとアーキテクチャを確認します
特にx86_64かaarch64かを確認してください。Dockerイメージを選ぶ際や、バイナリツールの互換性に影響します。

```bash
uname -a
```
ディスクの空き容量を確認します（重要）
Use%が100%に近い場合、更新作業は途中で止まり、システム破損の原因になります。不要なファイルを削除し、十分な空き容量を確保してください。

```bash
df -h
```
最後に、主要なミドルウェアのバージョンを記録します
Composerのバージョンがv1かv2かによっても挙動が変わるため、必ず確認します。

```bash
php -v
composer --version
mysql --version
```

Dockerを使用している場合は、ホストOSではなく、必ずコンテナの中に入ってこれらのコマンドを実行してください。

## Step 1 目標と要件の確認（調査）

いきなり `composer update` をしてはいけません。まずはゴールを決めます。例えば「Laravel 9 から 10 へ上げる」と決めた場合、Laravel 10 の公式ドキュメントにあるサーバー要件（Server Requirements）を確認します。

* PHPの最低バージョンはいくつか
* 必要なPHP拡張モジュールは何か
* データベースの対応バージョンはいくつか

この調査が全ての出発点です。

## Step 2 状態の保存

作業前に必ず現在の状態を保存します。Gitでのコミットはもちろんですが、データベースのダンプ（エクスポート）も必須です。VPSなどを使用している場合は、サーバーのスナップショットを取得するのが最も確実です。

## Step 3 土台の更新（ミドルウェア・環境）

Step 1で確認した要件に合わせて、まずはPHPやデータベースのバージョンを上げます。

Dockerを使用していない場合
サーバーにSSH接続し、OSのパッケージマネージャーを用いてPHPなどのバージョンを上げます。この時点で一時的に既存のLaravelアプリが動かなくなる可能性がありますが、想定内です。

Dockerを使用している場合
ここがDockerの強みです。Dockerfile内の記述（例 `FROM php:8.1-fpm`）を新しいバージョン（例 `php:8.2-fpm`）に書き換えてビルドし直します。ローカル環境で事前に動作確認ができるため、本番環境を壊すリスクを最小限に抑えられます。

## Step 4 フレームワークとアプリの更新

土台（PHPなど）が整って初めて、Laravel本体の更新を行います。`composer.json` の記述を修正し、依存パッケージを更新します。
ここで初めて、あなたの書いたコードと新しいLaravelとの間で不整合（Breaking Changes）が発生します。エラーログを見ながら、一つずつ修正していきます。

### 依存パッケージという伏兵

Laravel本体だけでなく、導入しているライブラリ（PDF生成やExcel操作など）も、新しいPHPやLaravelに対応している必要があります。これを無視すると、更新途中で進めなくなります。PackagistやGitHubのリポジトリを確認し、互換性のあるバージョンが存在するかを事前にチェックリストに加えてください。

## おわりに

初めてサーバーの中身を触った日、私は冷や汗をかきながらエンターキーを押しました。「もしこれで動かなくなったら、誰が直すんだろう」という孤独な恐怖は、今でも鮮明に覚えています。しかし、更新作業を通じて得られる知識は、単なるコード書きから「システム全体を俯瞰できるエンジニア」へとあなたを成長させてくれます。エラーが出ることは失敗ではありません。それはシステムがあなたに「ここを直せばもっと良くなる」と教えてくれている対話なのです。しっかりとバックアップを取り、手順を確認したら、勇気を持って最初の一歩を踏み出してください。その先には、より堅牢で快適な開発環境が待っています。

